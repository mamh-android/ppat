$(function () {
<% if @category == "All" %>
var chart = new Highcharts.Chart({
            chart: {
                renderTo: 'chart_container_<%= @category %>',
                type: 'spline'
            },
            title: {
                text: '<%= @device %>_<%= @os.branch %> Branch Power Battery'
            },
            subtitle: {
                text: null
            },
            xAxis: {
                type: "datetime",
                tickInterval: 24*3600*1000, // one day
                tickColor:"#ff0000",
                dateTimeLabelFormats:{
                    day: '%m/%e'
                }
            },
            yAxis: {
                title: {
                    text: 'Battery'
                },
                labels: {
                    formatter: function() {
                        return this.value +'mA'
                    }
                }
            },
            tooltip: {
                useHTML: true,
                formatter: function() {
                    var hour=Highcharts.dateFormat('%H', this.x);
                    hour /= 10;
                    return '<b>'+ this.series.name +
                            '</b><br/>'+
                            Highcharts.dateFormat('%Y-%m-%d', this.x) +
                            ' _ ('+hour + ')'+
                            '<br/><b>'+
                            this.y +'mA' +
                            '</b>'+
                            '<br/>' +
                            '<font color=\"#ff0000\">'+
                            getComment(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y) +
                            '</font>';
                }
            },
            plotOptions: {
                series: {
                    cursor: 'pointer',
                    point: {
                        events: {
                            click: function() {
                                var editcheckbox = $("#editcheckboxId");
                                var name=this.series.name;
                                var power=this.y;
                                var comments = $.trim(getComment(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y).toString());
                                var verify = getVerify(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y).toString();
                                $("#imagedate").html(Highcharts.dateFormat('%Y-%m-%d', this.x));
                                $("#casename").html(name);
                                $("#power").html(power);
                                $("#comment").html(comments);
                                if(verify.indexOf("F") != -1){
                                    $('input[name=verify]').get(1).checked=true;
                                }else if(verify.indexOf("P") != -1){
                                    $('input[name=verify]').get(0).checked=true;
                                }
                                //edit mode or show dutycycle mode
                                if(editcheckbox.attr("checked")){
                                    dialog.dialog( "open" );
                                }else{
                                    show_dc(name,power,Highcharts.dateFormat('%Y-%m-%d', this.x));
                                }

                            }
                        }
                    },
                    marker: {
                        lineWidth: 1
                    }
                }
            },
            series: [
            <% @scenarios.each do |scenario| %>
                {
                    <% @imagedatehour=0 %>
                    <% @imagedate=0 %>
                    name: '<%= scenario.name %>',
                    data:[<% @image_dates.each do |image| %>
                            <% if scenario.id == image.power_scenario_id %>
                                {
                                    //如果日期相等
                                    <% if @imagedate == image.image_date %>
                                        <% @imagedatehour += 10 %>
                                        //判断是否超过24小时
                                        <% if @imagedatehour>=24 %>
                                            <% @imagedatehour=23 %>
                                        <% end %>
                                    <% else %>
                                        <% @imagedatehour = 0 %>
                                    <% end %>
                                    <% @imagedate = image.image_date %>

                                    x: Date.UTC("<%= get_year(image.image_date) %>",
                                               "<%= get_month(image.image_date) %>",
                                               "<%= get_day(image.image_date) %>",
                                               "<%= @imagedatehour %>" ),
                                    y: <%= get_power(image.battery) %>,
                                    marker: {
                                        <% if image.verified == "P" %>
                                            fillColor: '#6dc22c'
                                        <% else if image.verified == "F" %>
                                            fillColor: '#ff0000'
                                            <% end %>
                                        <% end %>
                                    }
                                },
                            <% end %>
                        <% end %>
                    ]//end data
                },
            <% end %>
            ]//end series
        });


        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'chart_container_vcc_main_<%= @category %>',
                type: 'spline'
            },
            title: {
                text: '<%= @device %>_<%= @os.branch %> Branch Power Vcc_Main'
            },
            subtitle: {
                text: null
            },
            xAxis: {
                type: "datetime",
                tickInterval: 24*3600*1000, // one day
                tickColor:"#ff0000",
                dateTimeLabelFormats:{
                    day: '%m/%e'
                }
            },
            yAxis: {
                title: {
                    text: 'Vcc_Main'
                },
                labels: {
                    formatter: function() {
                        return this.value +'mA'
                    }
                }
            },
            tooltip: {
                useHTML: true,
                formatter: function() {
                    var hour=Highcharts.dateFormat('%H', this.x);
                    hour /= 10;
                    return '<b>'+ this.series.name +
                            '</b><br/>'+
                            Highcharts.dateFormat('%Y-%m-%d', this.x) +
                            ' _ ('+hour + ')'+
                            '<br/><b>'+
                            this.y +'mA' +
                            '</b>'+
                            '<br/>' +
                            '<font color=\"#ff0000\">'+
                            getComment(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y) +
                            '</font>';
                }
            },
            plotOptions: {
                series: {
                    cursor: 'pointer',
                    point: {
                        events: {
                            click: function() {
                                var editcheckbox = $("#editcheckboxId");
                                var name=this.series.name;
                                var power=this.y;
                                var comments = $.trim(getComment(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y).toString());
                                var verify = getVerify(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y).toString();
                                $("#imagedate").html(Highcharts.dateFormat('%Y-%m-%d', this.x));
                                $("#casename").html(name);
                                $("#power").html(power);
                                $("#comment").html(comments);
                                if(verify.indexOf("F") != -1){
                                    $('input[name=verify]').get(1).checked=true;
                                }else if(verify.indexOf("P") != -1){
                                    $('input[name=verify]').get(0).checked=true;
                                }
                                //edit mode or show dutycycle mode
                                if(editcheckbox.attr("checked")){
                                    dialog.dialog( "open" );
                                }else{
                                    show_dc(name,power,Highcharts.dateFormat('%Y-%m-%d', this.x));
                                }

                            }
                        }
                    },
                    marker: {
                        lineWidth: 1
                    }
                }
            },
            series: [
            <% @scenarios.each do |scenario| %>
                {
                    <% @imagedatehour=0 %>
                    <% @imagedate=0 %>
                    name: '<%= scenario.name %>',
                    data:[<% @image_dates.each do |image| %>
                            <% if scenario.id == image.power_scenario_id %>
                                {
                                    //如果日期相等
                                    <% if @imagedate == image.image_date %>
                                        <% @imagedatehour += 10 %>
                                        //判断是否超过24小时
                                        <% if @imagedatehour>=24 %>
                                            <% @imagedatehour=23 %>
                                        <% end %>
                                    <% else %>
                                        <% @imagedatehour = 0 %>
                                    <% end %>
                                    <% @imagedate = image.image_date %>

                                    x: Date.UTC("<%= get_year(image.image_date) %>",
                                               "<%= get_month(image.image_date) %>",
                                               "<%= get_day(image.image_date) %>",
                                               "<%= @imagedatehour %>" ),
                                    y: <%= get_power(image.vcc_main) %>,
                                    marker: {
                                        <% if image.verified == "P" %>
                                            fillColor: '#6dc22c'
                                        <% else if image.verified == "F" %>
                                            fillColor: '#ff0000'
                                            <% end %>
                                        <% end %>
                                    }
                                },
                            <% end %>
                        <% end %>
                    ]//end data
                },
            <% end %>
            ]//end series
        });
<% else %>
var chart = new Highcharts.Chart({
            chart: {
                renderTo: 'chart_container_<%= @category %>',
                type: 'spline'
            },
            title: {
                text: '<%= @device %>_<%= @os.branch %> Branch Power Battery'
            },
            subtitle: {
                text: null
            },
            xAxis: {
                type: "datetime",
                tickInterval: 24*3600*1000, // one day
                tickColor:"#ff0000",
                dateTimeLabelFormats:{
                    day: '%m/%e'
                }
            },
            yAxis: {
                title: {
                    text: 'Battery'
                },
                labels: {
                    formatter: function() {
                        return this.value +'mA'
                    }
                }
            },
            tooltip: {
                useHTML: true,
                formatter: function() {
                    var hour=Highcharts.dateFormat('%H', this.x);
                    hour /= 10;
                    return '<b>'+ this.series.name +
                            '</b><br/>'+
                            Highcharts.dateFormat('%Y-%m-%d', this.x) +
                            ' _ ('+hour + ')'+
                            '<br/><b>'+
                            this.y +'mA' +
                            '</b>'+
                            '<br/>' +
                            '<font color=\"#ff0000\">'+
                            getComment(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y) +
                            '</font>';
                }
            },
            plotOptions: {
                series: {
                    cursor: 'pointer',
                    point: {
                        events: {
                            click: function() {
                                var editcheckbox = $("#editcheckboxId");
                                var name=this.series.name;
                                var power=this.y;
                                var comments = $.trim(getComment(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y).toString());
                                var verify = getVerify(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y).toString();
                                $("#imagedate").html(Highcharts.dateFormat('%Y-%m-%d', this.x));
                                $("#casename").html(name);
                                $("#power").html(power);
                                $("#comment").html(comments);
                                if(verify.indexOf("F") != -1){
                                    $('input[name=verify]').get(1).checked=true;
                                }else if(verify.indexOf("P") != -1){
                                    $('input[name=verify]').get(0).checked=true;
                                }
                                //edit mode or show dutycycle mode
                                if(editcheckbox.attr("checked")){
                                    dialog.dialog( "open" );
                                }else{
                                    show_dc(name,power,Highcharts.dateFormat('%Y-%m-%d', this.x));
                                }

                            }
                        }
                    },
                    marker: {
                        lineWidth: 1
                    }
                }
            },
            series: [
            <% @scenarios.each do |scenario| %>
                <% if scenario.category == @category %>
                {
                    <% @imagedatehour=0 %>
                    <% @imagedate=0 %>
                    name: '<%= scenario.name %>',
                    data:[<% @image_dates.each do |image| %>
                            <% if scenario.id == image.power_scenario_id %>
                                {
                                    //如果日期相等
                                    <% if @imagedate == image.image_date %>
                                        <% @imagedatehour += 10 %>
                                        //判断是否超过24小时
                                        <% if @imagedatehour>=24 %>
                                            <% @imagedatehour=23 %>
                                        <% end %>
                                    <% else %>
                                        <% @imagedatehour = 0 %>
                                    <% end %>
                                    <% @imagedate = image.image_date %>

                                    x: Date.UTC("<%= get_year(image.image_date) %>",
                                               "<%= get_month(image.image_date) %>",
                                               "<%= get_day(image.image_date) %>",
                                               "<%= @imagedatehour %>" ),
                                    y: <%= get_power(image.battery) %>,
                                    marker: {
                                        <% if image.verified == "P" %>
                                            fillColor: '#6dc22c'
                                        <% else if image.verified == "F" %>
                                            fillColor: '#ff0000'
                                            <% end %>
                                        <% end %>
                                    }
                                },
                            <% end %>
                        <% end %>
                    ]//end data
                },
            <% end %>
            <% end %>
            ]//end series
        });


        chart = new Highcharts.Chart({
            chart: {
                renderTo: 'chart_container_vcc_main_<%= @category %>',
                type: 'spline'
            },
            title: {
                text: '<%= @device %>_<%= @os.branch %> Branch Power Vcc_Main'
            },
            subtitle: {
                text: null
            },
            xAxis: {
                type: "datetime",
                tickInterval: 24*3600*1000, // one day
                tickColor:"#ff0000",
                dateTimeLabelFormats:{
                    day: '%m/%e'
                }
            },
            yAxis: {
                title: {
                    text: 'Vcc_Main'
                },
                labels: {
                    formatter: function() {
                        return this.value +'mA'
                    }
                }
            },
            tooltip: {
                useHTML: true,
                formatter: function() {
                    var hour=Highcharts.dateFormat('%H', this.x);
                    hour /= 10;
                    return '<b>'+ this.series.name +
                            '</b><br/>'+
                            Highcharts.dateFormat('%Y-%m-%d', this.x) +
                            ' _ ('+hour + ')'+
                            '<br/><b>'+
                            this.y +'mA' +
                            '</b>'+
                            '<br/>' +
                            '<font color=\"#ff0000\">'+
                            getComment(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y) +
                            '</font>';
                }
            },
            plotOptions: {
                series: {
                    cursor: 'pointer',
                    point: {
                        events: {
                            click: function() {
                                var editcheckbox = $("#editcheckboxId");
                                var name=this.series.name;
                                var power=this.y;
                                var comments = $.trim(getComment(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y).toString());
                                var verify = getVerify(Highcharts.dateFormat('%Y-%m-%d', this.x), this.y).toString();
                                $("#imagedate").html(Highcharts.dateFormat('%Y-%m-%d', this.x));
                                $("#casename").html(name);
                                $("#power").html(power);
                                $("#comment").html(comments);
                                if(verify.indexOf("F") != -1){
                                    $('input[name=verify]').get(1).checked=true;
                                }else if(verify.indexOf("P") != -1){
                                    $('input[name=verify]').get(0).checked=true;
                                }
                                //edit mode or show dutycycle mode
                                if(editcheckbox.attr("checked")){
                                    dialog.dialog( "open" );
                                }else{
                                    show_dc(name,power,Highcharts.dateFormat('%Y-%m-%d', this.x));
                                }

                            }
                        }
                    },
                    marker: {
                        lineWidth: 1
                    }
                }
            },
            series: [
            <% @scenarios.each do |scenario| %>
                <% if scenario.category == @category %>
                {
                    <% @imagedatehour=0 %>
                    <% @imagedate=0 %>
                    name: '<%= scenario.name %>',
                    data:[<% @image_dates.each do |image| %>
                            <% if scenario.id == image.power_scenario_id %>
                                {
                                    //如果日期相等
                                    <% if @imagedate == image.image_date %>
                                        <% @imagedatehour += 10 %>
                                        //判断是否超过24小时
                                        <% if @imagedatehour>=24 %>
                                            <% @imagedatehour=23 %>
                                        <% end %>
                                    <% else %>
                                        <% @imagedatehour = 0 %>
                                    <% end %>
                                    <% @imagedate = image.image_date %>

                                    x: Date.UTC("<%= get_year(image.image_date) %>",
                                               "<%= get_month(image.image_date) %>",
                                               "<%= get_day(image.image_date) %>",
                                               "<%= @imagedatehour %>" ),
                                    y: <%= get_power(image.vcc_main) %>,
                                    marker: {
                                        <% if image.verified == "P" %>
                                            fillColor: '#6dc22c'
                                        <% else if image.verified == "F" %>
                                            fillColor: '#ff0000'
                                            <% end %>
                                        <% end %>
                                    }
                                },
                            <% end %>
                        <% end %>
                    ]//end data
                },
            <% end %>
            <% end %>
            ]//end series
        });
<% end %>
});